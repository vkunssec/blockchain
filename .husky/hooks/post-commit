#!/bin/sh

echo "Running post-commit hook"

# Verifica se há alterações na pasta docs/ comparando com o commit anterior
if git diff HEAD^ HEAD --quiet -- docs/; then
    echo "No changes in docs"
    exit 0
fi

echo "Changes detected in docs/"

# Verifica se o último commit já é um commit de documentação
LAST_COMMIT_MSG=$(git log -1 --pretty=%B)
if [[ "$LAST_COMMIT_MSG" == "docs: update docs" ]]; then
    echo "Last commit was already a docs update"
    exit 0
fi

# Salva o commit original temporariamente
ORIGINAL_COMMIT_MSG=$(git log -1 --pretty=%B)

# Desfaz o último commit mantendo as alterações
git reset --soft HEAD^

# Separa as alterações da documentação
git reset HEAD docs/
git add .
git commit -m "$ORIGINAL_COMMIT_MSG"

# Commit das alterações da documentação
git add docs/
git commit -m "docs: update docs"

echo "Both original changes and documentation changes committed successfully"
